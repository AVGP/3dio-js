/**
 * @preserve
 * @name base-query
 * @version 0.0.5-alpha.1
 * @description Parse and edit building data using simple APIs.
 * @see http://base-query.org/
 * @tutorial https://github.com/archilogic-com/base-query
 * @author archilogic <dev.rocks@archilogic.com> (https://archilogic.com)
 * @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.BASE=t()}(this,function(){"use strict";function e(){var e="undefined"!=typeof document?document.createElement("canvas"):null;if(!e)return null;var t=e.getContext("webgl")||e.getContext("experimental-webgl")||e.getContext("webgl",{antialias:!1})||e.getContext("experimental-webgl",{antialias:!1});if(!t)return null;var r=t.getExtension("WEBGL_debug_renderer_info"),n=t.getExtension("WEBGL_compressed_texture_s3tc");return{shadingLanguageVersion:t.getParameter(t.SHADING_LANGUAGE_VERSION),renderer:t.getParameter(t.RENDERER),vendor:t.getParameter(t.VENDOR),unmaskedRenderer:r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL),unmaskedVendor:r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxRenderbufferSize:t.getParameter(t.MAX_RENDERBUFFER_SIZE),supportsDds:!!n}}function t(){var e;if("undefined"!=typeof navigator&&(navigator.userAgent||navigator.vendor))e=navigator.userAgent||navigator.vendor;else{if("undefined"==typeof window||!window.opera)return!1;e=window.opera}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e,t){var r=(t=t||{}).s3Key,n=t.rootDirectory;if(!e)return Promise.reject("Missing buffer parameter.");"undefined"!=typeof Buffer&&e instanceof Buffer&&(e=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));var i=new Int32Array(e,0,K/4),l=i[0],u=i[1],c=i[2],p=i[3],h=K+c+p;if(n&&"/"!==n[n.length-1]&&(n+="/"),l!==$&&console.error("File header error: Wrong magic number. File is probably not data3d buffer format."),u!==Q&&console.error("File header error: Wrong version number: "+u+". Parser supports version: "+Q),e.byteLength!==h){var f="Can not parse Data3d buffer. Wrong buffer size: "+e.byteLength+" Expected: "+h;return console.error(f),Promise.reject(f)}var d,_=new Uint16Array(e,K,c/2),v=W.decode(_);try{d=JSON.parse(v)}catch(e){return Promise.reject(e)}var m=K+c;return a(d.data3d,function(t){s(t,e,m,r),n&&t.materials&&o(t,n)}),Promise.resolve(d.data3d)}function i(){return{decode:function(e){for(var t="",r=123===e[0]||91===e[1]?0:1,n=e.length-20,i=e.length;r<n;r+=20)t+=String.fromCharCode(e[r],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],e[r+10],e[r+11],e[r+12],e[r+13],e[r+14],e[r+15],e[r+16],e[r+17],e[r+18],e[r+19]);for(;r<i;r++)t+=String.fromCharCode(e[r]);return t}}}function o(e,t){var r,n,i,o,s,a,l=e.materialKeys||Object.keys(e.materials||{});for(r=0,n=l.length;r<n;r++)for(s=e.materials[l[r]],i=0,o=X.length;i<o;i++)s[a=X[i]]&&"/"!==s[a][0]&&(s[a]=t+s[a])}function s(e,t,r,n){var i,o,s,a=e.meshKeys||Object.keys(e.meshes||{});for(o=0,s=a.length;o<s;o++)void 0!==(i=e.meshes[a[o]]).positionsOffset&&void 0!==i.positionsLength&&(i.positions=new Float32Array(t,r+4*i.positionsOffset,i.positionsLength),delete i.positionsOffset,delete i.positionsLength),void 0!==i.normalsOffset&&void 0!==i.normalsLength&&(i.normals=new Float32Array(t,r+4*i.normalsOffset,i.normalsLength),delete i.normalsOffset,delete i.normalsLength),void 0!==i.uvsOffset&&void 0!==i.uvsLength&&(i.uvs=new Float32Array(t,r+4*i.uvsOffset,i.uvsLength),delete i.uvsOffset,delete i.uvsLength),void 0!==i.uvsLightmapOffset&&void 0!==i.uvsLightmapLength&&(i.uvsLightmap=new Float32Array(t,r+4*i.uvsLightmapOffset,i.uvsLightmapLength),delete i.uvsLightmapOffset,delete i.uvsLightmapLength),n&&(i.cacheKey=n+":"+a[o])}function a(e,t){if(t(e),e.children)for(var r=0,n=e.children.length;r<n;r++)a(e.children[r],t)}function l(e,t,r,n){return new Promise(function(i,o){var s=new XMLHttpRequest;s.onload=function(t){s.status>=200&&s.status<300?i(s.response):o("Http request to "+e+" returned status: "+s.status+". Body:\n"+s.response)},s.onerror=function(t){o("Http request error. URL: "+e)},s.open(t,e,!0),s.crossOrigin="Anonymous",s.responseType=r.toLowerCase(),s.send(n)})}function u(e,t,r,n){return new Promise(function(r,i){var o=null,s=!1;if(n)try{o=JSON.stringify(n)}catch(e){i("Error creating JSON string.")}var a=new XMLHttpRequest;a.crossOrigin="Anonymous",a.onload=function(t){var n;try{n=JSON.parse(a.responseText)}catch(r){return void i({message:"Http Request failed: Error parsing response JSON",url:e,status:a.status,headers:a.getAllResponseHeaders(),event:t})}a.status>=200&&a.status<300?r(n):i(n)},a.onerror=function(r){s||0!==a.status?i({message:"Http Request error",url:e,status:a.status,headers:a.getAllResponseHeaders(),event:r}):(s=!0,a.open(t,e,!0),a.setRequestHeader("Content-Type","text/plain"),a.send(o))},a.open(t,e,!0),"GET"!==t&&a.setRequestHeader("Content-Type","application/json"),a.send(o)})}function c(e){return 0==(e&e-1)&&0!==e}function p(e){if(e>J)return J;var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function h(e,t){var r=p(e.width),n=p(e.height),i=document.createElement("canvas");return i.width=r,i.height=n,i.getContext("2d").drawImage(e,0,0,r,n),console.log("Image size not compatible. Image has been resized from "+e.width+"x"+e.height+"px to "+i.width+"x"+i.height+"px.\n"+t),i}function f(e,t,r,n,i,o){return new Promise(function(t,r){var n=document.createElement("img");n.crossOrigin="Anonymous",n.onload=function(){var r=new THREE.Texture;r.sourceFile=e,r.s3Key=o;var i=c(n.width)&&c(n.height),s=n.width<=J&&n.height<=J;i&&s?r.image=n:(r.image=h(n,e),r.image.src=e),t(r)};var i=!1;n.onerror=function(){i?r("Error loading texture "+e):(i=!0,-1===e.indexOf("?")?e+="?cacheBust="+(new Date).getTime():e+="&cacheBust="+(new Date).getTime(),n.src=e)},n.src=e})}function d(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function v(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function m(e,t,r,n){for(var i=r*n*4,o=new Uint8Array(e,t,i),s=new Uint8Array(i),a=0,l=0,u=0;u<n;u++)for(var c=0;c<r;c++){var p=o[l],h=o[++l],f=o[++l],d=o[++l];l++,s[a]=f,s[++a]=h,s[++a]=p,s[++a]=d,a++}return s}function y(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},n=new Int32Array(e,0,31);if(n[0]!==Z)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(!n[20]&te)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var i,o=n[21],s=!1;switch(o){case re:i=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case ne:i=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case ie:i=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==n[22]&&16711680&n[23]&&65280&n[24]&&255&n[25]&&4278190080&n[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",v(o)),r;s=!0,i=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,n[2]&Y&&!1!==t&&(r.mipmapCount=Math.max(1,n[7])),r.isCubemap=!!(n[28]&ee),r.width=n[4],r.height=n[3];for(var a=n[1]+4,l=r.width,u=r.height,c=r.isCubemap?6:1,p=0;p<c;p++){for(var h=0;h<r.mipmapCount;h++){var f,d;s?d=(f=m(e,a,l,u)).length:(d=Math.max(4,l)/4*Math.max(4,u)/4*i,f=new Uint8Array(e,a,d));var _={data:f,width:l,height:u};r.mipmaps.push(_),a+=d,l=Math.max(.5*l,1),u=Math.max(.5*u,1)}l=r.width,u=r.height}return r}function g(e){return Math.log(e)/Math.LN2}function b(e,t,r,n,i,o){return new Promise(function(t,r){var n=new XMLHttpRequest;n.onload=function(i){if(n.status>=200&&n.status<300){var s,a=n.response;try{s=y(a,!0)}catch(t){var l="Error Loading DDS Texture\n"+e+"\n"+t.name+": "+t.message;return console.error(l),void r(l)}var u=g(Math.max(s.width,s.height))+1;if(s.mipmapCount!=u)return console.error("Reading DDS texture failed: "+e+"\nmipmaps counted: "+s.mipmapCount+", should be: "+u+"\nPlease make sure you have mipmap generation enabled when creating DDS textures from images."),void r("Error parsing DDS. Wrong mipmaps count. "+e);var c=new THREE.CompressedTexture;c.format=s.format,c.mipmaps=s.mipmaps,c.image.width=s.width,c.image.height=s.height,c.image.src=e,c.sourceFile=e,c.s3Key=o,c.bufferByteLength=a.byteLength,c.generateMipmaps=!1,t(c)}else r({message:"Http Request error",url:e,status:n.status,headers:n.getAllResponseHeaders(),event:i})},n.onerror=function(t){r({message:"Http Request error",url:e,status:n.status,headers:n.getAllResponseHeaders(),event:t})},n.open("GET",e,!0),n.crossOrigin="Anonymous",n.responseType="arraybuffer",n.send(null)})}function w(e){var t=e.url||e.uri,r=e.method||"GET",n=e.body,i=E(e.type,t,n);return oe[i]?oe[i](t,r,i,n):Promise.reject("Type "+i+" not supported.")}function E(e,t,r){return t?(t.split("/").pop().split(".").pop(),e?"texture"===e&&(e=x(t)):(r?r instanceof FormData?e="form-data":_.isObject(r)&&(e="url-encoded"):e=C(t),e||(e="text")),e):"text"}function C(e){var t,r,n,i=e.toLowerCase();for(r=0,n=le.length;r<n;r++)if(t=le[r],i.substring(i.length-t.length)===t)return se[t];return"text"}function x(e,t){var r=e.match(/\.[A-Za-z]+(?=\?|$)/i);if(r){var n=r[0].toLowerCase();return ae[n]}return!1}function j(e){console.error("Texture could not been loaded: ",e)}function T(e){void 0!==e&&(he[e]?he[e]++:he[e]=1)}function k(){var e=this,t=this.s3Key;t&&he[t]?0==--he[t]&&e.dispose():e.dispose()}function F(e,t,r,n,i,o,s){var a,l,u,c,p,h=[],f=[],d=[],_=0,v=!1,m=o?o.geometry:null,y=m?m.attributes:null,g=y&&y.uv&&y.uv.count>0,b=y&&y.uv2&&y.uv2.count>0;for(R=0,A=t.UV1.length;R<A;R++){if(c=t.UV1[R],a=n[c],u=ce[c],l=i[u],a){if(!g){console.error("Texture "+a+" could not be assigned because geometry has no UV vertices.");continue}v=!0}a?(p=!0,O=pe[n.wrap]||pe.repeat,l&&O!==l.wrapS&&(l.wrapS=O,l.wrapT=O,l.needsUpdate=!0),l&&l.s3Key&&a===l.s3Key&&(p=!1),p&&l&&s&&(i[u]&&i[u].disposeIfPossible&&i[u].disposeIfPossible(),i[u]=null),p&&(d[_]=ue.getTexture(a,{queue:e}).catch(j),f[_]=c,h[_]=u,_++,i.needsUpdate=!0)):i[u]&&(i[u]&&i[u].disposeIfPossible&&i[u].disposeIfPossible(),i[u]=null,i.needsUpdate=!0)}if(y){if(v&&n.size){var w=n.size[0],E=n.size[1],C=y.uv._scaleU||1,x=y.uv._scaleV||1;if(w!==C||E!==x){y.uv._source||(y.uv._source=y.uv.array);for(var F=y.uv._source,P=new Float32Array(F.length),R=0,A=P.length;R<A;R+=2)P[R]=F[R]/w,P[R+1]=F[R+1]/E;y.uv.array=P,y.uv._scaleU=w,y.uv._scaleV=E,y.uv.needsUpdate=!0}}n[t.UV2]&&(b?(c=t.UV2,a=n[c],d[_]=ue.getTexture(a,{queue:e}).catch(j),f[_]=c,h[_]=ce[c],_++):console.error("Lightmap "+n[t.UV2]+" could not be assigned because geometry has no lightmap UV (UV2) vertices."))}var S,O;return _?S=Promise.all(d).then(function(e){for(O=pe[n.wrap]||pe.repeat,R=0;R<_;R++)T(e[R].s3Key),e[R].disposeIfPossible=k,e[R].wrapS=O,e[R].wrapT=O,e[R].anisotropy=2,i[h[R]]&&i[h[R]].disposeIfPossible&&i[h[R]].disposeIfPossible(),i[h[R]]=e[R],i[h[R]].needsUpdate=!0;i.needsUpdate=!0,o&&o.geometry&&(o.geometry.buffersNeedUpdate=!0,o.geometry.uvsNeedUpdate=!0),r&&r.viewport.render()}):(S=Promise.resolve(),r&&r.viewport.render()),S}function P(e){var t=e.vm,r=e.material3d,n=e.mesh3d,i=e.attributes||{},o=void 0===e.reset||e.reset,s=e.loadingQueuePrefix,a=e.onFirstTextureSetLoaded;if(r.shininess=void 0!==i.specularCoef?i.specularCoef:.1,i.colorDiffuse?(r.color.r=i.colorDiffuse[0],r.color.g=i.colorDiffuse[1],r.color.b=i.colorDiffuse[2]):o&&(i.mapDiffuse?(r.color.r=1,r.color.g=1,r.color.b=1):(r.color.r=.85,r.color.g=.85,r.color.b=.85)),i.colorSpecular?(r.specular.r=i.colorSpecular[0],r.specular.g=i.colorSpecular[1],r.specular.b=i.colorSpecular[2]):o&&(r.specular||(r.specular=new THREE.Color),r.specular.r=.25,r.specular.g=.25,r.specular.b=.25),i.colorEmissive?(r.emissive.r=i.colorEmissive[0],r.emissive.g=i.colorEmissive[1],r.emissive.b=i.colorEmissive[2]):o&&(r.emissive||(r.emissive=new THREE.Color),r.emissive.r=0,r.emissive.g=0,r.emissive.b=0),(i.mapLight||i.mapLightPreview)&&(r.enhancedLightMap=r.enhancedLightMap||{},r.enhancedLightMap.intensity=void 0!==i.mapLightIntensity?i.mapLightIntensity:1,r.enhancedLightMap.center=void 0!==i.mapLightCenter?i.mapLightCenter:.5,r.enhancedLightMap.falloff=void 0!==i.mapLightFalloff?i.mapLightFalloff:.5),n){n.geometry.boundingBox||n.geometry.computeBoundingBox();var l=n.geometry.boundingBox,u=l.min.clone();u.applyMatrix4(n.matrixWorld);var c=l.max.y-l.min.y<.05,p=u.y<.1;n.castShadow=!(c&&p)&&i.castRealTimeShadows,n.receiveShadow=c&&p||i.receiveRealTimeShadows,n.material.needsUpdate=!0}r._texturesToBeLoaded={mapDiffuse:i.mapDiffuse,mapSpecular:i.mapSpecular,mapNormal:i.mapNormal,mapAlpha:i.mapAlpha,mapLight:i.mapLight,mapDiffusePreview:i.mapDiffusePreview,mapSpecularPreview:i.mapSpecularPreview,mapNormalPreview:i.mapNormalPreview,mapAlphaPreview:i.mapAlphaPreview,mapLightPreview:i.mapLightPreview};var h,f,d,_=i.mapDiffusePreview||i.mapSpecularPreview||i.mapNormalPreview||i.mapAlphaPreview||i.mapLightPreview,v=!U.isMobile&&U.webGl.supportsDds;return!v||_&&!r.firstTextureLoaded?(s&&(f=s+"TexturesLoRes"),h=F(f,de,t,i,r,n,!1),d=!0):(s&&(f=s+"TexturesHiRes"),h=F(f,fe,t,i,r,n,!1),d=!1),h.then(function(){void 0!==i.opacity&&i.opacity<1?(r.transparent=!0,r.opacity=i.opacity):i.mapAlpha?(r.transparent=!0,r.opacity=1):(r.transparent=!1,r.opacity=1),a&&a(),_&&(r.firstTextureLoaded=!0)}),d&&v&&h.then(function(){s&&(f=s+"TexturesHiRes"),F(f,fe,t,i,r,n,!1)}),h}function R(){this._wireframeGeometry=new THREE.BufferGeometry,this._wireframeGeometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(0),3)),this._wireframeMaterial=new THREE.LineBasicMaterial,this._positions=null,this._buffer=null,this._thresholdAngle=10,this._thickness=1,this._color=[0,0,0],this._opacity=1,THREE.Line.call(this,this._wireframeGeometry,this._wireframeMaterial,THREE.LinePieces)}function A(e){return e?(me[e]?me[e].refCount++:me[e]={geometry3d:new THREE.BufferGeometry,refCount:1},me[e].geometry3d):new THREE.BufferGeometry}function S(e,t){e&&me[e]?--me[e].refCount<1&&(me[e].geometry3d.dispose(),delete me[e]):t.dispose()}function O(e){this.threeParent=e.parent,this.meshKeys=[],this.meshes={},this.materialKeys=[],this.materials={},this._meshes3d={},this._wireframes3d={},this._materials3d={}}function L(e,t){var r=void 0===(t=t||{}).cdn||t.cdn,n=void 0===t.encode||t.encode,i=e,o=/^\/(.*)$/.exec(i);return o&&(i=o[1]),n&&!/^[\.\-\_\/a-zA-Z0-9]+$/.test(i)&&(i=encodeURIComponent(i)),r?"https://"+Ee+"/"+i:"https://"+Ce+".s3.amazonaws.com/"+i}var D=!("undefined"==typeof module||!module.exports||"undefined"==typeof process||"[object process]"!==Object.prototype.toString.call(process)||-1===process.title.indexOf("node")),B=e(),U={isMobile:t(),isNode:D,has:{webGl:!!B},webGl:B},I="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},M=r(function(e,t){!function(t){e.exports=function(){var e,t,r;return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var l="function"==typeof _dereq_&&_dereq_;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){return i(t[s][1][e]||e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new u(16),this._normalQueue=new u(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=l}function i(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function o(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var a;try{throw new Error}catch(e){a=e}var l=e("./schedule"),u=e("./queue"),c=e("./util");n.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){c.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},n.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},c.hasDevTools?(n.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?i.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},n.prototype.invoke=function(e,t,r){this._trampolineEnabled?o.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},n.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(n.prototype.invokeLater=i,n.prototype.invoke=o,n.prototype.settlePromises=s),n.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},t.exports=n,t.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,r){t.exports=function(e,t,r,n){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var u=r(o),c=new e(t);c._propagateFrom(this,1);var p=this._target();if(c._setBoundTo(u),u instanceof e){var h={promiseRejectionQueued:!1,promise:c,target:p,bindingPromise:u};p._then(t,s,void 0,c,h),u._then(a,l,void 0,c,h),c._setOnCancel(u)}else c._resolveCallback(p);return c},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],4:[function(e,t,r){function n(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=n,t.exports=o},{"./promise":22}],5:[function(e,t,r){var n=Object.create;if(n){var i=n(null),o=n(null);i[" size"]=o[" size"]=0}t.exports=function(t){function r(e,r){var n;if(null!=e&&(n=e[r]),"function"!=typeof n){var i="Object "+s.classString(e)+" has no method '"+s.toString(r)+"'";throw new t.TypeError(i)}return n}function n(e){return r(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s=e("./util"),a=s.canEvaluate;s.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(a){var r=(void 0)(e);t=null!==r?r:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,r){t.exports=function(t,r,n,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,l=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=s(e).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,r){t.exports=function(t){function r(e,r,a){return function(l){var u=a._boundValue();e:for(var c=0;c<e.length;++c){var p=e[c];if(p===Error||null!=p&&p.prototype instanceof Error){if(l instanceof p)return o(r).call(u,l)}else if("function"==typeof p){var h=o(p).call(u,l);if(h===s)return h;if(h)return o(r).call(u,l)}else if(n.isObject(l)){for(var f=i(p),d=0;d<f.length;++d){var _=f[d];if(p[_]!=l[_])continue e}return o(r).call(u,l)}}return t}}var n=e("./util"),i=e("./es5").keys,o=n.tryCatch,s=n.errorObj;return r}},{"./es5":13,"./util":36}],8:[function(e,t,r){t.exports=function(e){function t(){this._trace=new t.CapturedTrace(n())}function r(){if(i)return new t}function n(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=r,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var r=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,l=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=l,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=n,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){t.exports=function(t,r){function n(e,t){return{promise:t}}function i(){return!1}function o(e,t,r){var n=this;try{e(t,r,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+I.toString(e));n._attachCancellationCallback(e)})}catch(e){return e}}function s(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?I.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function a(){return this._onCancelField}function l(e){this._onCancelField=e}function u(){this._cancellationParent=void 0,this._onCancelField=void 0}function c(e,t){if(0!=(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function f(){this._trace=new A(this._peekContext())}function d(e,t){if(M(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=C(e);I.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),I.notEnumerableProp(e,"__stackCleaned__",!0)}}}function _(e,t,r,n,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&n._bitField))return;r&&(r+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),l=w(a),u=l.length-1;u>=0;--u){var c=l[u];if(!N.test(c)){var p=c.match(V);p&&(o="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(l.length>0)for(var h=l[0],u=0;u<a.length;++u)if(a[u]===h){u>0&&(s="\n"+a[u-1]);break}}var f="a promise was created in a "+r+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;n._warn(f,!0,t)}}function v(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),m(r)}function m(e,r,n){if(oe.warnings){var i,o=new U(e);if(r)n._attachExtraTrace(o);else if(oe.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var s=C(o);o.stack=s.message+"\n"+s.stack.join("\n")}ee("warning",o)||x(o,"",!0)}}function y(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}function g(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function b(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],i=t.length-1,o=t[i],s=-1,a=n.length-1;a>=0;--a)if(n[a]===o){s=a;break}for(a=s;a>=0;--a){var l=n[a];if(t[i]!==l)break;t.pop(),i--}t=n}}function w(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i="    (No stack trace)"===n||q.test(n),o=i&&re(n);i&&!o&&(z&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function E(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||q.test(n))break}return r>0&&"SyntaxError"!=e.name&&(t=t.slice(r)),t}function C(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?E(e):["    (No stack trace)"],{message:r,stack:"SyntaxError"==e.name?t:w(t)}}function x(e,t,r){if("undefined"!=typeof console){var n;if(I.isObject(e)){var i=e.stack;n=t+G(i,e)}else n=t+String(e);"function"==typeof L?L(n,r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function j(e,t,r,n){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){B.throwLater(e)}"unhandledRejection"===e?ee(e,r,n)||i||x(r,"Unhandled rejection "):ee(e,n)}function T(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():I.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+k(t)+">, no stack trace)"}function k(e){return e.length<41?e:e.substr(0,38)+"..."}function F(){return"function"==typeof ie}function P(e){var t=e.match(ne);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function R(e,t){if(F()){for(var r,n,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,l=0;l<i.length;++l)if(u=P(i[l])){r=u.fileName,s=u.line;break}for(l=0;l<o.length;++l){var u=P(o[l]);if(u){n=u.fileName,a=u.line;break}}s<0||a<0||!r||!n||r!==n||s>=a||(re=function(e){if(H.test(e))return!0;var t=P(e);return!!(t&&t.fileName===r&&s<=t.line&&t.line<=a)})}}function A(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ie(this,A),t>32&&this.uncycle()}var S,O,L,D=t._getDomain,B=t._async,U=e("./errors").Warning,I=e("./util"),M=I.canAttachTrace,H=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,N=/\((?:timers\.js):\d+:\d+\)/,V=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,q=null,G=null,z=!1,K=!(0==I.env("BLUEBIRD_DEBUG")),$=!(0==I.env("BLUEBIRD_WARNINGS")||!K&&!I.env("BLUEBIRD_WARNINGS")),Q=!(0==I.env("BLUEBIRD_LONG_STACK_TRACES")||!K&&!I.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=I.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&($||!!I.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),B.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){j("rejectionHandled",S,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),j("unhandledRejection",O,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,r){return m(e,t,r||this)},t.onPossiblyUnhandledRejection=function(e){var t=D();O="function"==typeof e?null===t?e:I.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=D();S="function"==typeof e?null===t?e:I.domainBind(t,e):void 0};var W=function(){};t.longStackTraces=function(){if(B.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!oe.longStackTraces&&F()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;oe.longStackTraces=!0,W=function(){if(B.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),B.enableTrampoline(),oe.longStackTraces=!1},t.prototype._captureStackTrace=f,t.prototype._attachExtraTrace=d,r.activateLongStackTraces(),B.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return oe.longStackTraces&&F()};var J=function(){try{if("function"==typeof CustomEvent)return e=new CustomEvent("CustomEvent"),I.global.dispatchEvent(e),function(e,t){var r=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!I.global.dispatchEvent(r)};if("function"==typeof Event){var e=new Event("CustomEvent");return I.global.dispatchEvent(e),function(e,t){var r=new Event(e.toLowerCase(),{cancelable:!0});return r.detail=t,!I.global.dispatchEvent(r)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),I.global.dispatchEvent(e),function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e.toLowerCase(),!1,!0,t),!I.global.dispatchEvent(r)}}catch(e){}return function(){return!1}}(),Z=function(){return I.isNode?function(){return process.emit.apply(process,arguments)}:I.global?function(e){var t="on"+e.toLowerCase(),r=I.global[t];return!!r&&(r.apply(I.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),Y={promiseCreated:n,promiseFulfilled:n,promiseRejected:n,promiseResolved:n,promiseCancelled:n,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:n},ee=function(e){var t=!1;try{t=Z.apply(null,arguments)}catch(e){B.throwLater(e),t=!0}var r=!1;try{r=J(e,Y[e].apply(null,arguments))}catch(e){B.throwLater(e),r=!0}return r||t};t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&W()),"warnings"in e){var r=e.warnings;oe.warnings=!!r,X=oe.warnings,I.isObject(r)&&"wForgottenReturn"in r&&(X=!!r.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!oe.cancellation){if(B.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=u,t.prototype._propagateFrom=c,t.prototype._onCancel=a,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=s,t.prototype._execute=o,te=c,oe.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!oe.monitoring?(oe.monitoring=!0,t.prototype._fireEvent=ee):!e.monitoring&&oe.monitoring&&(oe.monitoring=!1,t.prototype._fireEvent=i)),t},t.prototype._fireEvent=i,t.prototype._execute=function(e,t,r){try{e(t,r)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var te=p,re=function(){return!1},ne=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;I.inherits(A,Error),r.CapturedTrace=A,A.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,i=this;void 0!==i;++n)t.push(i),i=i._parent;for(n=(e=this._length=n)-1;n>=0;--n){var o=t[n].stack;void 0===r[o]&&(r[o]=n)}for(n=0;n<e;++n){var s=r[t[n].stack];if(void 0!==s&&s!==n){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var a=n>0?t[n-1]:this;s<e-1?(a._parent=t[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var l=a._length+1,u=n-2;u>=0;--u)t[u]._length=l,l++;return}}}},A.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=C(e),r=t.message,n=[t.stack],i=this;void 0!==i;)n.push(w(i.stack.split("\n"))),i=i._parent;b(n),g(n),I.notEnumerableProp(e,"stack",y(r,n)),I.notEnumerableProp(e,"__stackCleaned__",!0)}};var ie=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():T(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,q=e,G=t;var r=Error.captureStackTrace;return re=function(e){return H.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return q=/@/,G=t,z=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in n||!i||"number"!=typeof Error.stackTraceLimit?(G=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?T(t):t.toString()},null):(q=e,G=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(L=function(e){console.warn(e)},I.isNode&&process.stderr.isTTY?L=function(e,t){var r=t?"[33m":"[31m";console.warn(r+e+"[0m\n")}:I.isNode||"string"!=typeof(new Error).stack||(L=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var oe={warnings:$,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&t.longStackTraces(),{longStackTraces:function(){return oe.longStackTraces},warnings:function(){return oe.warnings},cancellation:function(){return oe.cancellation},monitoring:function(){return oe.monitoring},propagateFromFunction:function(){return te},boundValueFunction:function(){return h},checkForgottenReturns:_,setBounds:R,warn:m,deprecated:v,CapturedTrace:A,fireDomEvent:J,fireGlobalEvent:Z}}},{"./errors":12,"./util":36}],10:[function(e,t,r){t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1],n=function(){throw t};return this.caught(e,n)},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();var i=function(){return n};return this.caught(r,i)}}},{}],11:[function(e,t,r){t.exports=function(e,t){function r(){return o(this)}function n(e,r){return i(e,r,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(r,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,n){return i(e,n,t,0)._then(r,void 0,void 0,e,void 0)},e.mapSeries=n}},{}],12:[function(e,t,r){function n(e,t){function r(n){if(!(this instanceof r))return new r(n);p(this,"message","string"==typeof n?n:t),p(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(r,Error),r}function i(e){if(!(this instanceof i))return new i(e);p(this,"name","OperationalError"),p(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(p(this,"message",e.message),p(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,s,a=e("./es5"),l=a.freeze,u=e("./util"),c=u.inherits,p=u.notEnumerableProp,h=n("Warning","warning"),f=n("CancellationError","cancellation error"),d=n("TimeoutError","timeout error"),_=n("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=n("TypeError","type error"),s=n("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<v.length;++m)"function"==typeof Array.prototype[v[m]]&&(_.prototype[v[m]]=Array.prototype[v[m]]);a.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var y=0;_.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(n=i.join("\n"))+"\n"}return y--,t},c(i,Error);var g=Error.__BluebirdErrorTypes__;g||(g=l({CancellationError:f,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:_}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:g,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(e,t,r){var n=function(){return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var r in e)i.call(e,r)&&t.push(r);return t},l=function(e,t){return{value:e[t]}},u=function(e,t,r){return e[t]=r.value,e},c=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},h=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:h,keys:a,names:a,defineProperty:u,getDescriptor:l,freeze:c,getPrototypeOf:p,isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,r){t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],15:[function(e,t,r){t.exports=function(t,r,n){function i(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function s(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function a(){return u.call(this,this.promise._target()._settledValue())}function l(e){if(!s(this,e))return h.e=e,h}function u(e){var i=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(i._boundValue()):u.call(i._boundValue(),e);if(c===n)return c;if(void 0!==c){i._setReturnedNonUndefined();var f=r(c,i);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var d=new p("late cancellation observer");return i._attachExtraTrace(d),h.e=d,h}f.isPending()&&f._attachCancellationCallback(new o(this))}return f._then(a,l,void 0,this,void 0)}}}return i.isRejected()?(s(this),h.e=e,h):(s(this),e)}var c=e("./util"),p=t.CancellationError,h=c.errorObj,f=e("./catch_filter")(n);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){s(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,n){return"function"!=typeof e?this.then():this._then(r,n,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},t.prototype.tapCatch=function(e){var r=arguments.length;if(1===r)return this._passThrough(e,1,void 0,u);var n,i=new Array(r-1),o=0;for(n=0;n<r-1;++n){var s=arguments[n];if(!c.isObject(s))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+c.classString(s)));i[o++]=s}i.length=o;var a=arguments[n];return this._passThrough(f(i,a,this),1,void 0,u)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,r){t.exports=function(t,r,n,i,o,s){function a(e,r,n){for(var o=0;o<r.length;++o){n._pushContext();var s=h(r[o])(e);if(n._popContext(),s===p){n._pushContext();var a=t.reject(p.e);return n._popContext(),a}var l=i(s,n);if(l instanceof t)return l}return null}function l(e,r,i,o){if(s.cancellation()){var a=new t(n),l=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return l}),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new t(n))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var u=e("./errors").TypeError,c=e("./util"),p=c.errorObj,h=c.tryCatch,f=[];c.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),e=h(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var r=this._promise;if(e===p)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(n);var o=i(n,this._promise);if(o instanceof t||null!==(o=a(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,n=l,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new n(void 0,void 0,r,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("expecting a function but got "+c.classString(e));f.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new l(e,this),i=n.promise();return n._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,r){t.exports=function(t,r,n,i,o,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj,t.join=function(){var e,t=arguments.length-1;t>0&&"function"==typeof arguments[t]&&(e=arguments[t]);var n=[].slice.call(arguments);e&&n.pop();var i=new r(n).promise();return void 0!==e?i.spread(e):i}}},{"./util":36}],18:[function(e,t,r){t.exports=function(t,r,n,i,o,s){function a(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var i=u();this._callback=null===i?t:c.domainBind(i,t),this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}function l(e,r,i,o){if("function"!=typeof r)return n("expecting a function but got "+c.classString(r));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+c.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,r,s,o).promise()}var u=t._getDomain,c=e("./util"),p=c.tryCatch,h=c.errorObj,f=t._async;c.inherits(a,r),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,r){var n=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(r<0){if(r=-1*r-1,n[r]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return n[r]=e,this._queue.push(r),!1;null!==a&&(a[r]=e);var u=this._promise,c=this._callback,f=u._boundValue();u._pushContext();var d=p(c).call(f,e,r,o),_=u._popContext();if(s.checkForgottenReturns(d,_,null!==a?"Promise.filter":"Promise.map",u),d===h)return this._reject(d.e),!0;var v=i(d,this._promise);if(v instanceof t){var m=(v=v._target())._bitField;if(0==(50397184&m))return l>=1&&this._inFlight++,n[r]=v,v._proxy(this,-1*(r+1)),!1;if(0==(33554432&m))return 0!=(16777216&m)?(this._reject(v._reason()),!0):(this._cancel(),!0);d=v._value()}n[r]=d}return++this._totalResolved>=o&&(null!==a?this._filter(n,a):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,o=0;o<r;++o)e[o]&&(n[i++]=t[o]);n.length=i,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return l(this,e,t,null)},t.map=function(e,t,r,n){return l(e,t,r,n)}}},{"./util":36}],19:[function(e,t,r){t.exports=function(t,r,n,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var i=a(e).apply(this,arguments),s=n._popContext();return o.checkForgottenReturns(i,s,"Promise.method",n),n._resolveFromSyncValue(i),n}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var n=new t(r);n._captureStackTrace(),n._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];l=s.isArray(u)?a(e).apply(c,u):a(e).call(c,u)}else l=a(e)();var p=n._popContext();return o.checkForgottenReturns(l,p,"Promise.try",n),n._resolveFromSyncValue(l),n},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,r){function n(e){return e instanceof Error&&u.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(n(e)){(t=new l(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=u.keys(e),i=0;i<r.length;++i){var o=r[i];c.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(r,n){if(null!==e){if(r){var o=i(a(r));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(n);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,l=e("./errors").OperationalError,u=e("./es5"),c=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,r){t.exports=function(t){function r(e,t){var r=this;if(!o.isArray(e))return n.call(r,e,t);var i=a(t).apply(r._boundValue(),[null].concat(e));i===l&&s.throwLater(i.e)}function n(e,t){var r=this._boundValue(),n=void 0===e?a(t).call(r,null):a(t).call(r,null,e);n===l&&s.throwLater(n.e)}function i(e,t){var r=this;if(!e){var n=new Error(e+"");n.cause=e,e=n}var i=a(t).call(r._boundValue(),e);i===l&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,l=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=n;void 0!==t&&Object(t).spread&&(o=r),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){t.exports=function(){function r(){}function n(e,t){if(null==e||e.constructor!==i)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new y("expecting a function but got "+f.classString(t))}function i(e){e!==b&&n(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(e){this.promise._resolveCallback(e)}function s(e){this.promise._rejectCallback(e,!1)}function a(e){var t=new i(b);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var l,u=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new i.PromiseInspection(this._target())},p=function(e){return i.reject(new y(e))},h={},f=e("./util");l=f.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},f.notEnumerableProp(i,"_getDomain",l);var d=e("./es5"),_=e("./async"),v=new _;d.defineProperty(i,"_async",{value:v});var m=e("./errors"),y=i.TypeError=m.TypeError;i.RangeError=m.RangeError;var g=i.CancellationError=m.CancellationError;i.TimeoutError=m.TimeoutError,i.OperationalError=m.OperationalError,i.RejectionError=m.OperationalError,i.AggregateError=m.AggregateError;var b=function(){},w={},E={},C=e("./thenables")(i,b),x=e("./promise_array")(i,b,C,p,r),j=e("./context")(i),T=j.create,k=e("./debuggability")(i,j),F=(k.CapturedTrace,e("./finally")(i,C,E)),P=e("./catch_filter")(E),R=e("./nodeback"),A=f.errorObj,S=f.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),i=0;for(r=0;r<t-1;++r){var o=arguments[r];if(!f.isObject(o))return p("Catch statement predicate: expecting an object but got "+f.classString(o));n[i++]=o}return n.length=i,e=arguments[r],this.then(void 0,P(n,e,this))}return this.then(void 0,e)},i.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},i.prototype.then=function(e,t){if(k.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+f.classString(e);arguments.length>1&&(r+=", "+f.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},i.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},i.prototype.spread=function(e){return"function"!=typeof e?p("expecting a function but got "+f.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new x(this).promise()},i.prototype.error=function(e){return this.caught(f.originatesFromRejection,e)},i.getNewLibraryCopy=t.exports,i.is=function(e){return e instanceof i},i.fromNode=i.fromCallback=function(e){var t=new i(b);t._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=S(e)(R(t,r));return n===A&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(e){return new x(e).promise()},i.cast=function(e){var t=C(e);return t instanceof i||((t=new i(b))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(e){var t=new i(b);return t._captureStackTrace(),t._rejectCallback(e,!0),t},i.setScheduler=function(e){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));return v.setScheduler(e)},i.prototype._then=function(e,t,r,n,o){var s=void 0!==o,a=s?o:new i(b),u=this._target(),c=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&c)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var p=l();if(0!=(50397184&c)){var h,d,_=u._settlePromiseCtx;0!=(33554432&c)?(d=u._rejectionHandler0,h=e):0!=(16777216&c)?(d=u._fulfillmentHandler0,h=t,u._unsetRejectionIsUnhandled()):(_=u._settlePromiseLateCancellationObserver,d=new g("late cancellation observer"),u._attachExtraTrace(d),h=t),v.invoke(_,u,{handler:null===p?h:"function"==typeof h&&f.domainBind(p,h),promise:a,receiver:n,value:d})}else u._addCallbacks(e,t,a,n,p);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){v.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==h)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(e){return this[4*e-4+2]},i.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},i.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,r=e._rejectionHandler0,n=e._promise0,i=e._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(t,r,n,i,null)},i.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=h),this._addCallbacks(r,n,i,o,null)},i.prototype._addCallbacks=function(e,t,r,n,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:f.domainBind(i,t));else{var s=4*o-4;this[s+2]=r,this[s+3]=n,"function"==typeof e&&(this[s+0]=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:f.domainBind(i,t))}return this._setLength(o+1),o},i.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},i.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(u(),!1);var r=C(e,this);if(!(r instanceof i))return this._fulfill(e);t&&this._propagateFrom(r,2);var n=r._target();if(n!==this){var o=n._bitField;if(0==(50397184&o)){var s=this._length();s>0&&n._migrateCallback0(this);for(var a=1;a<s;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&o))this._fulfill(n._value());else if(0!=(16777216&o))this._reject(n._reason());else{var l=new g("late cancellation observer");n._attachExtraTrace(l),this._reject(l)}}else this._reject(u())}},i.prototype._rejectCallback=function(e,t,r){var n=f.ensureErrorObject(e),i=n===e;if(!i&&!r&&k.warnings()){var o="a promise was rejected with a non-error: "+f.classString(e);this._warn(o,!0)}this._attachExtraTrace(n,!!t&&i),this._reject(e)},i.prototype._resolveFromExecutor=function(e){if(e!==b){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,r)});r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)}},i.prototype._settlePromiseFromHandler=function(e,t,r,n){var i=n._bitField;if(0==(65536&i)){n._pushContext();var o;t===w?r&&"number"==typeof r.length?o=S(e).apply(this._boundValue(),r):(o=A).e=new y("cannot .spread() a non-array: "+f.classString(r)):o=S(e).call(t,r);var s=n._popContext();0==(65536&(i=n._bitField))&&(o===E?n._reject(r):o===A?n._rejectCallback(o.e,!1):(k.checkForgottenReturns(o,s,"",n,this),n._resolveCallback(o)))}},i.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(e){this._rejectionHandler0=e},i.prototype._settlePromise=function(e,t,n,o){var s=e instanceof i,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(s&&e._invokeInternalOnCancel(),n instanceof F&&n.isFinallyHandler()?(n.cancelPromise=e,S(t).call(n,o)===A&&e._reject(A.e)):t===c?e._fulfill(c.call(n)):n instanceof r?n._promiseCancelled(e):s||e instanceof x?e._cancel():n.cancel()):"function"==typeof t?s?(l&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,o,e)):t.call(n,o,e):n instanceof r?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(o,e):n._promiseRejected(o,e)):s&&(l&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(o):e._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,o=e.value;"function"==typeof t?r instanceof i?this._settlePromiseFromHandler(t,n,o,r):t.call(n,o,r):r instanceof i&&r._reject(o)},i.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},i.prototype._settlePromise0=function(e,t,r){var n=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,i,t)},i.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var r=u();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():v.settlePromises(this))}},i.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return v.fatalError(e,f.isNode);(65535&t)>0?v.settlePromises(this):this._ensurePossibleRejectionHandled()}},i.prototype._fulfillPromises=function(e,t){for(var r=1;r<e;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},i.prototype._rejectPromises=function(e,t){for(var r=1;r<e;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},i.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){return k.deprecated("Promise.defer","new Promise"),{promise:new i(b),resolve:o,reject:s}},f.notEnumerableProp(i,"_makeSelfResolutionError",u),e("./method")(i,b,C,p,k),e("./bind")(i,b,C,k),e("./cancel")(i,x,p,k),e("./direct_resolve")(i),e("./synchronous_inspection")(i),e("./join")(i,x,C,b,v,l),i.Promise=i,i.version="3.5.0",e("./map.js")(i,x,p,C,b,k),e("./call_get.js")(i),e("./using.js")(i,p,C,T,b,k),e("./timers.js")(i,b,k),e("./generators.js")(i,p,b,C,r,k),e("./nodeify.js")(i),e("./promisify.js")(i,b),e("./props.js")(i,x,C,p),e("./race.js")(i,b,C,p),e("./reduce.js")(i,x,p,C,b,k),e("./settle.js")(i,x,k),e("./some.js")(i,x,p),e("./filter.js")(i,b),e("./each.js")(i,b),e("./any.js")(i),f.toFastProperties(i),f.toFastProperties(i.prototype),a({a:1}),a({b:2}),a({c:3}),a(1),a(function(){}),a(void 0),a(!1),a(new i(b)),k.setBounds(_.firstLineError,f.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,r){t.exports=function(t,r,n,i,o){function s(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function a(e){var n=this._promise=new t(r);e instanceof t&&n._propagateFrom(e,3),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=e("./util");return l.isArray,l.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(r,o){var a=n(this._values,this._promise);if(a instanceof t){var u=(a=a._target())._bitField;if(this._values=a,0==(50397184&u))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=l.asArray(a)))0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(s(o));else{var c=i("expecting an array or an iterable object but got "+l.classString(a)).reason();this._promise._rejectCallback(c,!1)}},a.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<r;++a){var l=n(e[a],i);s=l instanceof t?(l=l._target())._bitField:null,o?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,a),this._values[a]=l):o=0!=(33554432&s)?this._promiseFulfilled(l._value(),a):0!=(16777216&s)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(l,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,r){t.exports=function(t,r){function n(e){return!b.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,r){var n=h.getDataPropertyOrDefault(e,t+r,y);return!!n&&i(n)}function s(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new m("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,r,n){for(var a=h.inheritedDataKeys(e),l=[],u=0;u<a.length;++u){var c=a[u],p=e[c],f=n===w||w(c,p,e);"function"!=typeof p||i(p)||o(e,c,t)||!n(c,p,e,f)||l.push(c,p)}return s(l,t,r),l}function l(e,n,i,o,s,a){function l(){var i=n;n===p&&(i=this);var o=new t(r);o._captureStackTrace();var s="string"==typeof c&&this!==u?this[c]:e,l=f(o,a);try{s.apply(i,d(arguments,l))}catch(e){o._rejectCallback(_(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var u=function(){return this}(),c=e;return"string"==typeof c&&(e=o),h.notEnumerableProp(l,"__isPromisified__",!0),l}function u(e,t,r,n,i){for(var o=new RegExp(E(t)+"$"),s=a(e,t,o,r),l=0,u=s.length;l<u;l+=2){var c=s[l],f=s[l+1],d=c+t;if(n===C)e[d]=C(c,p,c,f,t,i);else{var _=n(f,function(){return C(c,p,c,f,t,i)});h.notEnumerableProp(_,"__isPromisified__",!0),e[d]=_}}return h.toFastProperties(e),e}function c(e,t,r){return C(e,t,void 0,e,null,r)}var p={},h=e("./util"),f=e("./nodeback"),d=h.withAppended,_=h.maybeWrapAsError,v=h.canEvaluate,m=e("./errors").TypeError,y={__isPromisified__:!0},g=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],b=new RegExp("^(?:"+g.join("|")+")$"),w=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},E=function(e){return e.replace(/([$])/,"\\$")},C=v?void 0:l;t.promisify=function(e,t){if("function"!=typeof e)throw new m("expecting a function but got "+h.classString(e));if(i(e))return e;var r=c(e,void 0===(t=Object(t)).context?p:t.context,!!t.multiArgs);return h.copyDescriptors(e,r,n),r},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new m("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var r=!!(t=Object(t)).multiArgs,n=t.suffix;"string"!=typeof n&&(n="Async");var i=t.filter;"function"!=typeof i&&(i=w);var o=t.promisifier;if("function"!=typeof o&&(o=C),!h.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=h.inheritedDataKeys(e),a=0;a<s.length;++a){var l=e[s[a]];"constructor"!==s[a]&&h.isClass(l)&&(u(l.prototype,n,i,o,r),u(l,n,i,o,r))}return u(e,n,i,o,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,r){t.exports=function(t,r,n,i){function o(e){var t,r=!1;if(void 0!==a&&e instanceof a)t=p(e),r=!0;else{var n=c.keys(e),i=n.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=n[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,r?-6:-3)}function s(e){var r,s=n(e);return u(s)?(r=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&r._propagateFrom(s,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,l=e("./util"),u=l.isObject,c=e("./es5");"function"==typeof Map&&(a=Map);var p=function(){function e(e,n){this[t]=e,this[t+r]=n,t++}var t=0,r=0;return function(n){r=n.size,t=0;var i=new Array(2*n.size);return n.forEach(e,i),i}}(),h=function(e){for(var t=new a,r=e.length/2|0,n=0;n<r;++n){var i=e[r+n],o=e[n];t.set(i,o)}return t};l.inherits(o,r),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var r;if(this._isMap)r=h(this._values);else{r={};for(var n=this.length(),i=0,o=this.length();i<o;++i)r[this._values[i+n]]=this._values[i]}return this._resolve(r),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,r){function n(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=r,this._length=n},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,n(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,r){t.exports=function(t,r,n,i){function o(e,o){var l=n(e);if(l instanceof t)return a(l);if(null===(e=s.asArray(e)))return i("expecting an array or an iterable object but got "+s.classString(e));var u=new t(r);void 0!==o&&u._propagateFrom(o,3);for(var c=u._fulfill,p=u._reject,h=0,f=e.length;h<f;++h){var d=e[h];(void 0!==d||h in e)&&t.cast(d)._then(c,p,void 0,u,null)}return u}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,r){t.exports=function(t,r,n,i,o,s){function a(e,r,n,i){this.constructor$(e);var s=h();this._fn=null===s?r:f.domainBind(s,r),void 0!==n&&(n=t.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,r,i){return"function"!=typeof t?n("expecting a function but got "+f.classString(t)):new a(e,t,r,i).promise()}function c(e){this.accum=e,this.array._gotAccum(e);var r=i(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(p,void 0,void 0,this,void 0)):p.call(this,r)}function p(e){var r=this.array,n=r._promise,i=d(r._fn);n._pushContext();var o;(o=void 0!==r._eachValues?i.call(n._boundValue(),e,this.index,this.length):i.call(n._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=o);var a=n._popContext();return s.checkForgottenReturns(o,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),o}var h=t._getDomain,f=e("./util"),d=f.tryCatch;f.inherits(a,r),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},a.prototype._iterate=function(e){this._values=e;var r,n,i=e.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;n<i;++n){var o={accum:null,value:e[n],index:n,length:i,array:this};r=r._then(c,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(l,l,void 0,r,this)},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,r,n){return u(e,t,r,n)}}},{"./util":36}],29:[function(e,t,r){var n,i=e("./util"),o=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},s=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var a=I.setImmediate,l=process.nextTick;n=i.isRecentNode?function(e){a.call(I,e)}:function(e){l.call(process,e)}}else if("function"==typeof s&&"function"==typeof s.resolve){var u=s.resolve();n=function(e){u.then(e)}}else n="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:o:function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),r=!1}).observe(n,t);var i=function(){r||(r=!0,n.classList.toggle("foo"))};return function(r){var n=new MutationObserver(function(){n.disconnect(),r()});n.observe(e,t),i()}}();t.exports=n},{"./util":36}],30:[function(e,t,r){t.exports=function(t,r,n){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,r),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var r=new o;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},i.prototype._promiseRejected=function(e,t){var r=new o;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,r){t.exports=function(t,r,n){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new i(e),o=r.promise();return r.setHowMany(t),r.init(),o}var s=e("./util"),a=e("./errors").RangeError,l=e("./errors").AggregateError,u=s.isArray,c={};s.inherits(i,r),i.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new l,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,r){t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,r){t.exports=function(t,r){function n(e,n){if(c(e)){if(e instanceof t)return e;var i=o(e);if(i===u)return n&&n._pushContext(),l=t.reject(i.e),n&&n._popContext(),l;if("function"==typeof i){if(s(e)){var l=new t(r);return e._then(l._fulfill,l._reject,void 0,l,null),l}return a(e,i,n)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return u.e=e,u}}function s(e){try{return p.call(e,"_promise0")}catch(e){return!1}}function a(e,n,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,p,!0),a=null)}var a=new t(r),c=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var p=!0,h=l.tryCatch(n).call(e,o,s);return p=!1,a&&h===u&&(a._rejectCallback(h.e,!0,!0),a=null),c}var l=e("./util"),u=l.errorObj,c=l.isObject,p={}.hasOwnProperty;return n}},{"./util":36}],34:[function(e,t,r){t.exports=function(t,r,n){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),l=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return c(+this).thenReturn(e)},c=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(u,null,null,e,void 0),n.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(r),a=setTimeout(function(){s._fulfill()},+e),n.cancellation()&&s._setOnCancel(new i(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return c(e,this)};var p=function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new l("operation timed out"):new l(t),a.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()};t.prototype.timeout=function(e,t){e=+e;var r,a,l=new i(setTimeout(function(){r.isPending()&&p(r,t,a)},e));return n.cancellation()?(a=this.then(),(r=a._then(o,s,void 0,l,void 0))._setOnCancel(l)):r=this._then(o,s,void 0,l,void 0),r}}},{"./util":36}],35:[function(e,t,r){t.exports=function(t,r,n,i,o,s){function a(e){setTimeout(function(){throw e},0)}function l(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(e,r){function i(){if(s>=u)return c._fulfill();var o=l(e[s++]);if(o instanceof t&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(r),e.promise)}catch(e){return a(e)}if(o instanceof t)return o._then(i,a,null,null,null)}i()}var s=0,u=e.length,c=new t(o);return i(),c}function c(e,t,r){this._data=e,this._promise=t,this._context=r}function p(e,t,r){this.constructor$(e,t,r)}function h(e){return c.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function f(e){this.length=e,this.promise=null,this[e-1]=null}var d=e("./util"),_=e("./errors").TypeError,v=e("./util").inherits,m=d.errorObj,y=d.tryCatch,g={};c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():g},c.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=t!==g?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},c.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(p,c),p.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},f.prototype._resultCancelled=function(){for(var e=this.length,r=0;r<e;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return r("expecting a function but got "+d.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(e=(o=arguments[0]).length,a=!1):(o=arguments,e--);for(var l=new f(e),p=0;p<e;++p){var _=o[p];if(c.isDisposer(_)){var v=_;(_=_.promise())._setDisposable(v)}else{var g=n(_);g instanceof t&&(_=g._then(h,null,null,{resources:l,index:p},void 0))}l[p]=_}for(var b=new Array(l.length),p=0;p<b.length;++p)b[p]=t.resolve(l[p]).reflect();var w=t.all(b).then(function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return m.e=r.error(),m;if(!r.isFulfilled())return void w.cancel();e[t]=r.value()}E._pushContext(),i=y(i);var n=a?i.apply(void 0,e):i(e),o=E._popContext();return s.checkForgottenReturns(n,o,"Promise.using",E),n}),E=w.lastly(function(){var e=new t.PromiseInspection(w);return u(l,e)});return l.promise=E,E._setOnCancel(l),E},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new p(e,this,i());throw new _}}},{"./errors":12,"./util":36}],36:[function(e,t,r){function n(){try{var e=P;return P=null,e.apply(this,arguments)}catch(e){return F.e=e,F}}function i(e){return P=e,n}function o(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function s(e){return"function"==typeof e||"object"==typeof e&&null!==e}function a(e){return o(e)?new Error(v(e)):e}function l(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;r<n;++r)i[r]=e[r];return i[r]=t,i}function u(e,t,r){if(!T.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function c(e,t,r){if(o(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return T.defineProperty(e,t,n),e}function p(e){throw e}function h(e){try{if("function"==typeof e){var t=T.names(e.prototype),r=T.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=O.test(e+"")&&T.names(e).length>0;if(r||n||i)return!0}return!1}catch(e){return!1}}function f(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}function d(e){return L.test(e)}function _(e,t,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=t+i+r;return n}function v(e){try{return e+""}catch(e){return"[no string representation]"}}function m(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function y(e){try{c(e,"isOperational",!0)}catch(e){}}function g(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function b(e){return m(e)&&T.propertyIsWritable(e,"stack")}function w(e){return{}.toString.call(e)}function E(e,t,r){for(var n=T.names(e),i=0;i<n.length;++i){var o=n[i];if(r(o))try{T.defineProperty(t,o,T.getDescriptor(e,o))}catch(e){}}}function C(e){return H?process.env[e]:void 0}function x(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function j(e,t){return e.bind(t)}var T=e("./es5"),k="undefined"==typeof navigator,F={e:{}},P,R="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==I?I:void 0!==this?this:null,A=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},S=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(T.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=r(e)}catch(e){return n}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var l=Object.getOwnPropertyDescriptor(e,a);null!=l&&null==l.get&&null==l.set&&n.push(a)}}e=T.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var i=[];e:for(var o in r)if(n.call(r,o))i.push(o);else{for(var s=0;s<e.length;++s)if(n.call(e[s],o))continue e;i.push(o)}return i}}(),O=/this\s*\.\s*\S+\s*=/,L=/^[a-z$_][a-z$_0-9]*$/i,D=function(){return"stack"in new Error?function(e){return b(e)?e:new Error(v(e))}:function(e){if(b(e))return e;try{throw new Error(v(e))}catch(e){return e}}}(),B=function(e){return T.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var U="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};B=function(e){return T.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?U(e):null}}var M="undefined"!=typeof process&&"[object process]"===w(process).toLowerCase(),H="undefined"!=typeof process&&void 0!==process.env,N={isClass:h,isIdentifier:d,inheritedDataKeys:S,getDataPropertyOrDefault:u,thrower:p,isArray:T.isArray,asArray:B,notEnumerableProp:c,isPrimitive:o,isObject:s,isError:m,canEvaluate:k,errorObj:F,tryCatch:i,inherits:A,withAppended:l,maybeWrapAsError:a,toFastProperties:f,filledRange:_,toString:v,canAttachTrace:b,ensureErrorObject:D,originatesFromRejection:g,markAsOriginatingFromRejection:y,classString:w,copyDescriptors:E,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:M,hasEnvVariables:H,env:C,global:R,getNativePromise:x,domainBind:j};N.isRecentNode=N.isNode&&function(){var e=process.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),N.isNode&&N.toFastProperties(process);try{throw new Error}catch(e){N.lastLineError=e}t.exports=N},{"./es5":13}]},{},[4])(4)}()}(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)});if(function(e){function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=s(t);return t.readAsArrayBuffer(e),r}function l(e){var t=new FileReader,r=s(t);return t.readAsText(e),r}function u(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function c(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&g(e))this._bodyArrayBuffer=c(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!b(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function f(e,t){var r=(t=t||{}).body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=h(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function _(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],g=function(e){return e&&DataView.prototype.isPrototypeOf(e)},b=ArrayBuffer.isView||function(e){return e&&y.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,n){e=t(e),n=r(n);var i=this.map[e];this.map[e]=i?i+","+n:n},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,n){this.map[t(e)]=r(n)},i.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},m.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},p.call(f.prototype),p.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];v.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=f,e.Response=v,e.fetch=function(e,t){return new Promise(function(r,n){var i=new f(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:_(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;r(new v(t,e))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials&&(o.withCredentials=!0),"responseType"in o&&m.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:global),!console.time||!console.timeEnd){var H={};console.time=function(e){H[e]=(new Date).getTime()},console.timeEnd=function(e){H[key]&&(console.log(key+": "+((new Date).getTime()-H[key])+"ms"),delete H[key])}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}}();var N="base-query",V="0.0.5-alpha.1",q="http://base-query.org/",G=r(function(e){!function(t){var r={};r.VERSION="1.3.0";var n,i={},o=function(e,t){return function(){return t.apply(e,arguments)}},s=function(){var e,t,r=arguments,n=r[0];for(t=1;t<r.length;t++)for(e in r[t])e in n||!r[t].hasOwnProperty(e)||(n[e]=r[t][e]);return n},a=function(e,t){return{value:e,name:t}};r.DEBUG=a(1,"DEBUG"),r.INFO=a(2,"INFO"),r.TIME=a(3,"TIME"),r.WARN=a(4,"WARN"),r.ERROR=a(8,"ERROR"),r.OFF=a(99,"OFF");var l=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};l.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(r.DEBUG,arguments)},info:function(){this.invoke(r.INFO,arguments)},warn:function(){this.invoke(r.WARN,arguments)},error:function(){this.invoke(r.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(r.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(r.TIME,[e,"end"])},invoke:function(e,t){n&&this.enabledFor(e)&&n(t,s({level:e},this.context))}};var u=new l({filterLevel:r.OFF});!function(){var e=r;e.enabledFor=o(u,u.enabledFor),e.debug=o(u,u.debug),e.time=o(u,u.time),e.timeEnd=o(u,u.timeEnd),e.info=o(u,u.info),e.warn=o(u,u.warn),e.error=o(u,u.error),e.log=e.info}(),r.setHandler=function(e){n=e},r.setLevel=function(e){u.setLevel(e);for(var t in i)i.hasOwnProperty(t)&&i[t].setLevel(e)},r.get=function(e){return i[e]||(i[e]=new l(s({name:e},u.context)))},r.createDefaultHandler=function(e){(e=e||{}).formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(i,o){i=Array.prototype.slice.call(i);var s,a=console.log;o.level===r.TIME?(s=(o.name?"["+o.name+"] ":"")+i[0],"start"===i[1]?console.time?console.time(s):t[s]=(new Date).getTime():console.timeEnd?console.timeEnd(s):n(a,[s+": "+((new Date).getTime()-t[s])+"ms"])):(o.level===r.WARN&&console.warn?a=console.warn:o.level===r.ERROR&&console.error?a=console.error:o.level===r.INFO&&console.info&&(a=console.info),e.formatter(i,o),n(a,i))}},r.useDefaults=function(e){r.setLevel(e&&e.defaultLevel||r.DEBUG),r.setHandler(r.createDefaultHandler(e))},e.exports?e.exports=r:(r._prevLogger=t.Logger,r.noConflict=function(){return t.Logger=r._prevLogger,r},t.Logger=r)}(I)});G.useDefaults();var z="undefined"!=typeof window&&"[object Window]"===Object.prototype.toString.call(window);if(z&&console.log(N+" v"+V+"\n"+q),U.isNode)global.THREE=require("three");else if("undefined"==typeof THREE)throw new Error('Base query requires THREE.js library. Please add <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min.js"><\/script> to your html file at top of <head> section.');var K=16,$=1094988612,Q=1,X=["mapDiffuseSource","mapSpecularSource","mapNormalSource","mapAlphaSource","mapLightSource","mapDiffuse","mapSpecular","mapNormal","mapAlpha","mapLight","mapDiffusePreview","mapSpecularPreview","mapNormalPreview","mapAlphaPreview","mapLightPreview"],W=window&&window.TextDecoder?new window.TextDecoder("utf-16"):i(),J=U.has.webGl?U.webGl.maxTextureSize||2048:2048,Z=542327876,Y=131072,ee=512,te=4,re=d("DXT1"),ne=d("DXT3"),ie=d("DXT5");w.get=function(e){return w({method:"GET",url:e})},w.getTexture=function(e){return w({method:"GET",type:"texture",url:e})};var oe={text:l,arrayBuffer:l,blob:l,json:u,imageTexture:f,ddsTexture:b},se={buffer:"arrayBuffer",txt:"text",json:"json"},ae={".dds":"ddsTexture",".jpg":"imageTexture",".jpeg":"imageTexture",".jpe":"imageTexture",".png":"imageTexture",".gif":"imageTexture",".svg":"imageTexture"},le=Object.keys(se),ue={getTexture:function(e){return w.getTexture("https://dnvf9esa6v418.cloudfront.net"+e)}},ce={mapDiffuse:"map",mapSpecular:"specularMap",mapNormal:"normalMap",mapAlpha:"alphaMap",mapLight:"lightMap",mapDiffusePreview:"map",mapSpecularPreview:"specularMap",mapNormalPreview:"normalMap",mapAlphaPreview:"alphaMap",mapLightPreview:"lightMap"},pe={repeat:1e3,mirror:1002,clamp:1001},he={},fe={UV1:["mapDiffuse","mapSpecular","mapNormal","mapAlpha"],UV2:"mapLight"},de={UV1:["mapDiffusePreview","mapSpecularPreview","mapNormalPreview","mapAlphaPreview"],UV2:"mapLightPreview"};R.prototype=Object.create(THREE.Line.prototype),R.prototype.constructor=R,R.prototype.update=function(e){var t=e.positions,r=void 0===e.thresholdAngle?this._thresholdAngle:e.thresholdAngle,n=void 0===e.thickness?this._thickness:e.thickness,i=void 0===e.color?this._color:e.color,o=void 0===e.opacity?this._opacity:e.opacity;if(0===n)this.visible=!1;else{if(this._buffer&&r===this._thresholdAngle&&compareArrays(this._positions,t))0===this._thickness&&(this.visible=!0);else{var s=new Float32Array(27);s.length?(this._wireframeGeometry.attributes.position.array=s,this._wireframeGeometry.attributes.position.needsUpdate=!0,this.visible=!0):this.visible=!1,this._buffer=s,this._positions=t,this._thresholdAngle=r}this._wireframeMaterial.color.r=i[0],this._wireframeMaterial.color.g=i[1],this._wireframeMaterial.color.b=i[2],this._wireframeMaterial.opacity=o,this._wireframeMaterial.linewidth=n,this._color=i,this._opacity=o}this._thickness=n},R.prototype.destroy=function(){this._wireframeGeometry=null,this._wireframeMaterial=null,this._positions=null,this._buffer=null,this._thresholdAngle=null,this._thickness=null,this._color=null,this._opacity=null};var _e={front:0,back:1,both:2},ve=Math.PI/180,me={};O.prototype={set:function(e,t){t=t||{};var r,n,i,o,s,a,l,u,c,p,h,f,d,_,v,m,y=e.meshes||this.meshes,g=e.meshKeys,b=e.materials||this.materials,w=e.materialKeys,E=e.loadingQueuePrefix||t.loadingQueuePrefix,C=t.onFirstTextureSetLoaded,x=this;if(y){for(g||(g=Object.keys(y)),_=0,v=g.length;_<v;_++)r=g[_],n=(j=y[r]).material,o=j.positions,s=j.uvs,a=j.uvsLightmap,u=j.normals,j.position,f=j.rotRad,d=j.rotDeg,l=j.scale,x._materials3d[r]||((h=new THREE.MeshPhongMaterial({opacity:.5,transparent:!0})).name=n,b||P({material3d:h}),x._materials3d[r]=h),x._materials3d[r].side=_e[y[r].side]||_e.front,x._meshes3d[r]?p=(c=x._meshes3d[r]).geometry:(p=A(j.cacheKey),(c=new THREE.Mesh(p,h)).userData=x.userData,x.threeParent.add(c),x._meshes3d[r]=c,i=new R,x._wireframes3d[r]=i),l&&c.scale.set(l[0],l[1],l[2]),f?c.rotation.set(f[0],f[1],f[2]):d&&c.rotation.set(d[0]*ve,d[1]*ve,d[2]*ve),void 0===p.attributes.position?(p.attributes.position=new THREE.BufferAttribute(o,3),this.vm&&this.vm.viewport&&this.vm.viewport.webglView&&(x.vm.viewport.webglView.modelBoundingBoxNeedsUpdate=!0)):p.attributes.position.array!==o&&(p.attributes.position.array=o,p.attributes.position.needsUpdate=!0,p.computeBoundingSphere(),this.vm&&this.vm.viewport&&this.vm.viewport.webglView&&(x.vm.viewport.webglView.modelBoundingBoxNeedsUpdate=!0)),void 0===p.attributes.normal?p.attributes.normal=new THREE.BufferAttribute(u,3):p.attributes.normal.array!==u&&(p.attributes.normal.array=u,p.attributes.normal.needsUpdate=!0),s?void 0===p.attributes.uv?p.attributes.uv=new THREE.BufferAttribute(s,2):p.attributes.uv.array!==s&&(p.attributes.uv.array=s,p.attributes.uv.needsUpdate=!0,delete p.attributes.uv._scaleU,delete p.attributes.uv._scaleV,delete p.attributes.uv._source):p.attributes.uv&&delete p.attributes.uv,a?void 0===p.attributes.uv2?p.attributes.uv2=new THREE.BufferAttribute(a,2):p.attributes.uv2.array!==a&&(p.attributes.uv2.array=a,p.attributes.uv2.needsUpdate=!0):p.attributes.uv2&&delete p.attributes.uv2,p.attributesKeys=Object.keys(p.attributes),b[n]&&x._wireframes3d[r].update({positions:o,thickness:void 0===b[n].wireframeThickness?0:b[n].wireframeThickness,thresholdAngle:b[n].wireframeThresholdAngle,color:b[n].wireframeColor,opacity:b[n].wireframeOpacity});var j;Object.keys(x._meshes3d).forEach(function(e,t){if(j=x._meshes3d[e],!y[e]){console.log(x._meshes3d,e);var r=x._meshes3d[e].geometry;S(x.meshes[e].cacheKey,r);var n=x._meshes3d[e];n.parent&&n.parent.remove(n);var i=x._materials3d[e];i.map&&i.map.disposeIfPossible(),i.specularMap&&i.specularMap.disposeIfPossible(),i.normalMap&&i.normalMap.disposeIfPossible(),i.alphaMap&&i.alphaMap.disposeIfPossible(),i.lightMap&&i.lightMap.disposeIfPossible(),i.dispose(),delete x._meshes3d[e],delete x._wireframes3d[e],delete x._materials3d[e]}}),x.meshKeys=g,x.meshes=y}if(b){var T,k=[];for(_=0,v=x.meshKeys.length;_<v;_++)r=x.meshKeys[_],(T=b[n=x.meshes[r].material])&&Object.keys(T).length&&(k[_]=P({vm:x.vm,loadingQueuePrefix:E,mesh3d:x._meshes3d[r],material3d:x._materials3d[r],attributes:b[n],onFirstTextureSetLoaded:C}));m=Promise.all(k),x.materialKeys=w,x.materials=b}return m||(m=Promise.resolve()),m.then(function(){x.isDestroyed})},hasMeshes:function(){return Object.keys(this._meshes3d).length>0},setMeshes:function(e){this.set({meshes:e})},setMaterials:function(e,t){this.set({materials:e},t)},reset:function(){this.set({meshes:{},materials:{}})},destroy:function(){this.isDestroyed=!0,this.reset(),this.vm=null,this.threeParent=null,this.userData=null,this.threeParent=null,this.meshKeys=null,this.meshes=null,this.materialKeys=null,this.materials=null,this._meshes3d=null,this._materials3d=null}};var ye=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,ge={};ge.generate=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})},ge.validate=function(e){return!(!e||"string"!=typeof e)&&ye.test(e)};var be=function(){return U.isNode?require("node-fetch"):"undefined"!=typeof fetch?fetch:(console.warn("Missing global fetch API."),function(){throw new Error("Missing global fetch API.")})}(),we=function(e,t){return be(e,t).then(function(e){return e.arrayBuffer()}).then(function(e){return n(e)})},Ee="dnvf9esa6v418.cloudfront.net",Ce="archilogic-content-beta",xe=function(e,t){return we(L(e))},je={three:{View:O},store:{get:xe},data3d:{decodeBuffer:n},io:{fetch:be,request:w,loadData3d:we},utils:{uuid:ge},runtime:U};return je});
//# sourceMappingURL=base-query-0.0.5-alpha.1.min.js.map